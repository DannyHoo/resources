<p style="font-size:24px;display: block;line-height: 60px;text-align: center;padding-bottom:20px;">我 的 贡 献</p>

<form class="layui-form layui-form-pane" action="">
    <div class="layui-form-item">
        <label class="layui-form-label">资源标题</label>
        <div class="layui-input-block">
            <input type="text" name="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">资源大小</label>
            <div class="layui-input-inline">
                <input type="text" name="username" lay-verify="required" placeholder="资源大小(单位K、M、G)" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">资源语言</label>
            <div class="layui-input-inline">
                <input type="text" name="username" lay-verify="required" placeholder="请输入语言" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
    </div>
    <!--<div class="layui-form-item">
        <label class="layui-form-label">短输入框</label>
        <div class="layui-input-inline">
            <input type="text" name="username" lay-verify="required" placeholder="请输入语言" autocomplete="off"
                   class="layui-input">
        </div>
    </div>-->
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">资源时间</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" id="date1" placeholder="yyyy-MM-dd">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">分享方式</label>
            <div class="layui-input-inline">
                <input type="text" name="number" autocomplete="off" class="layui-input">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">资源类型</label>
            <div class="layui-input-inline">
                <input type="text" name="username" lay-verify="required" placeholder="资源大小(单位K、M、G)" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">星级评分</label>
            <div class="layui-input-inline">
                <input type="text" name="username" lay-verify="required" placeholder="请选择星级评分" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">适用环境</label>
        <div class="layui-input-inline">
            <input type="text" name="username" lay-verify="required" placeholder="请输入环境" autocomplete="off"
                   class="layui-input">
        </div>
    </div>
    <!--<div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">范围</label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="price_min" placeholder="￥" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-form-mid">-</div>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="price_max" placeholder="￥" autocomplete="off" class="layui-input">
            </div>
        </div>
    </div>-->

    <div id="divTextEditor">
        <p>初始化的内容</p>
        <p>初始化的内容</p>
    </div>
    <script type="text/javascript" src="${ctxPath}/plugins/editor/wangEditor.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/qiniu-js@<version>/dist/qiniu.min.js"></script>

</form>

<div class="layui-form-item">
    <button id="submitEdit" class="layui-btn" lay-submit="" lay-filter="demo2-">提 交 编 辑</button>
</div>

<script>
    //创建富文本编辑器 http://www.wangeditor.com/index.html
    var E = window.wangEditor;
    var editor = new E('#divTextEditor');
    // 自定义菜单配置
    editor.customConfig.menus = [
        'head',  // 标题
        'bold',  // 粗体
        'fontSize',  // 字号
        'fontName',  // 字体
        'italic',  // 斜体
        'underline',  // 下划线
        'strikeThrough',  // 删除线
        'foreColor',  // 文字颜色
        'backColor',  // 背景颜色
        'link',  // 插入链接
        'list',  // 列表
        'justify',  // 对齐方式
        'quote',  // 引用
        'emoticon',  // 表情
        'image',  // 插入图片
        'table',  // 表格
        'video',  // 插入视频
        'code',  // 插入代码
        'undo',  // 撤销
        'redo'  // 重复
    ];
    // 下面两个配置，使用其中一个即可显示“上传图片”的tab。但是两者不要同时使用！！！
    //editor.customConfig.uploadImgShowBase64 = true;   // 使用 base64 保存图片，简单方便，但可能对显示性能有影响
    editor.customConfig.uploadImgServer = '/gateway/fileupload/image';  // 上传图片到服务器

    editor.customConfig.uploadFileName = 'uploadPic';
    editor.customConfig.uploadImgMaxSize = 3 * 1024 * 1024; // 图片大小限制为 3M
    editor.customConfig.uploadImgMaxLength = 5; //限制一次最多上传 5 张图片
    editor.customConfig.uploadImgTimeout = 100000;//timeout时间改为10s

    editor.customConfig.pasteFilterStyle = false;//关闭粘贴样式的过滤，保留粘贴内容格式，默认不保留原格式
    //editor.customConfig.pasteIgnoreImg = true;//忽略掉粘贴内容中的图片，默认可粘贴

    editor.customConfig.onblur = function (html) {//失去焦点的动作
        // html 即编辑器中的内容
        console.log('onblur', html)
    };

    editor.customConfig.customAlert = function (info) {//上传图片的错误提示默认使用alert弹出，你也可以自定义用户体验更好的提示方式
        // info 是需要提示的内容
        alert('自定义提示：' + info)
    }

    // 自定义配置颜色（字体颜色、背景色）
    editor.customConfig.colors = [
        '#000000',
        '#eeece0',
        '#1c487f',
        '#4d80bf',
        '#c24f4a',
        '#8baa4a',
        '#7b5ba1',
        '#46acc8',
        '#f9963b',
        '#ffffff'
    ];

    editor.create();

    //editor.txt.html('<p>用 JS 设置的内容</p>');//初始化editor内容
    //editor.txt.append('<p>追加的内容</p>');//向editor追加内容
    //editor.txt.clear();//清空编辑器内容

    // 插入网络图片，url即插入图片的地址
    /*editor.customConfig.linkImgCallback = function (url) {
     console.log(url)
     }*/

    //上传到服务器
    editor.customConfig.uploadImgHooks = {
        before: function (xhr, editor, files) {
            // 图片上传之前触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，files 是选择的图片文件

            // 如果返回的结果是 {prevent: true, msg: 'xxxx'} 则表示用户放弃上传
            // return {
            //     prevent: true,
            //     msg: '放弃上传'
            // }
        },
        success: function (xhr, editor, result) {
            // 图片上传并返回结果，图片插入成功之后触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，result 是服务器端返回的结果
            alert("success:"+result);
        },
        fail: function (xhr, editor, result) {
            // 图片上传并返回结果，但图片插入错误时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，result 是服务器端返回的结果
            alert("fail:"+result);
        },
        error: function (xhr, editor) {
            // 图片上传出错时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象
            alert("error");
        },
        timeout: function (xhr, editor) {
            // 图片上传超时时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象
            alert("timeout");
        },

        // 如果服务器端返回的不是 {errno:0, data: [...]} 这种格式，可使用该配置
        // （但是，服务器端返回的必须是一个 JSON 格式字符串！！！否则会报错）
        customInsert: function (insertImg, result, editor) {
            // 图片上传并返回结果，自定义插入图片的事件（而不是编辑器自动插入图片！！！）
            // insertImg 是插入图片的函数，editor 是编辑器对象，result 是服务器端返回的结果

            // 举例：假如上传图片成功后，服务器端返回的是 {url:'....'} 这种格式，即可这样插入图片：
            var url = result.url
            insertImg(url)

            // result 必须是一个 JSON 格式字符串！！！否则报错
            alert("customInsert");
        }
    }

    /*// 初始化七牛上传
     uploadInit()
     // 初始化七牛上传的方法
     function uploadInit() {
     // 获取相关 DOM 节点的 ID
     var btnId = editor.imgMenuId;
     var containerId = editor.toolbarElemId;
     var textElemId = editor.textElemId;

     // 创建上传对象
     var uploader = Qiniu.uploader({
     runtimes: 'html5,flash,html4',    //上传模式,依次退化
     browse_button: btnId,       //上传选择的点选按钮，**必需**
     uptoken_url: '/gateway/qiniu/uptoken',
     //Ajax请求upToken的Url，**强烈建议设置**（服务端提供）
     // uptoken : '<Your upload token>',
     //若未指定uptoken_url,则必须指定 uptoken ,uptoken由其他程序生成
     // unique_names: true,
     // 默认 false，key为文件名。若开启该选项，SDK会为每个文件自动生成key（文件名）
     // save_key: true,
     // 默认 false。若在服务端生成uptoken的上传策略中指定了 `sava_key`，则开启，SDK在前端将不对key进行任何处理
     domain: 'http://7xrjl5.com1.z0.glb.clouddn.com/',
     //bucket 域名，下载资源时用到，**必需**
     container: containerId,           //上传区域DOM ID，默认是browser_button的父元素，
     max_file_size: '100mb',           //最大文件体积限制
     flash_swf_url: '../js/plupload/Moxie.swf',  //引入flash,相对路径
     filters: {
     mime_types: [
     //只允许上传图片文件 （注意，extensions中，逗号后面不要加空格）
     {title: "图片文件", extensions: "jpg,gif,png,bmp"}
     ]
     },
     max_retries: 3,                   //上传失败最大重试次数
     dragdrop: true,                   //开启可拖曳上传
     drop_element: textElemId,        //拖曳上传区域元素的ID，拖曳文件或文件夹后可触发上传
     chunk_size: '4mb',                //分块上传时，每片的体积
     auto_start: true,                 //选择文件后自动上传，若关闭需要自己绑定事件触发上传
     init: {
     'FilesAdded': function (up, files) {
     plupload.each(files, function (file) {
     // 文件添加进队列后,处理相关的事情
     printLog('on FilesAdded');
     });
     },
     'BeforeUpload': function (up, file) {
     // 每个文件上传前,处理相关的事情
     printLog('on BeforeUpload');
     },
     'UploadProgress': function (up, file) {
     // 显示进度
     printLog('进度 ' + file.percent)
     },
     'FileUploaded': function (up, file, info) {
     // 每个文件上传成功后,处理相关的事情
     // 其中 info 是文件上传成功后，服务端返回的json，形式如
     // {
     //    "hash": "Fh8xVqod2MQ1mocfI4S4KpRL6D98",
     //    "key": "gogopher.jpg"
     //  }
     printLog(info);
     // 参考http://developer.qiniu.com/docs/v6/api/overview/up/response/simple-response.html

     var domain = up.getOption('domain');
     var res = $.parseJSON(info);
     var sourceLink = domain + res.key; //获取上传成功后的文件的Url

     printLog(sourceLink);

     // 插入图片到editor
     editor.cmd.do('insertHtml', '<img src="' + sourceLink + '" style="max-width:100%;"/>')
     },
     'Error': function (up, err, errTip) {
     //上传出错时,处理相关的事情
     printLog('on Error');
     },
     'UploadComplete': function () {
     //队列文件处理完毕后,处理相关的事情
     printLog('on UploadComplete');
     }
     // Key 函数如果有需要自行配置，无特殊需要请注释
     //,
     // 'Key': function(up, file) {
     //     // 若想在前端对每个文件的key进行个性化处理，可以配置该函数
     //     // 该配置必须要在 unique_names: false , save_key: false 时才生效
     //     var key = "";
     //     // do something with key here
     //     return key
     // }
     }
     // domain 为七牛空间（bucket)对应的域名，选择某个空间后，可通过"空间设置->基本设置->域名设置"查看获取
     // uploader 为一个plupload对象，继承了所有plupload的方法，参考http://plupload.com/docs
     });
     }*/
    //提交编辑
    document.getElementById('submitEdit').addEventListener('click', function () {
        alert(editor.txt.html())
    }, false)

    // 封装 console.log 函数
    function printLog(title, info) {
        window.console && console.log(title, info);
    }

</script>



