<p style="font-size:24px;display: block;line-height: 60px;text-align: center;padding-bottom:20px;">我 的 贡 献</p>

<form class="layui-form layui-form-pane" action="">
    <div class="layui-form-item">
        <label class="layui-form-label">资源标题</label>
        <div class="layui-input-block">
            <input type="text" id="title" name="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">模板类型</label>
        <div class="layui-input-block">
            <select id="pageTemplate" name="interest" lay-filter="aihao">
                <option value="read">阅读类型</option>
                <option value="download">下载类型</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">一级分类</label>
            <div class="layui-input-inline">
                <select lay-filter="firstCategory" name="modules" lay-verify="required" lay-search="">
                    <option value="">直接选择或搜索选择</option>
                    <option value="Softwares">软件下载</option>
                    <option value="Course">教程资源</option>
                    <option value="SourceCode">源码分享</option>
                    <option value="News">今日头条</option>
                    <option value="Entertainment">娱乐放松</option>
                    <option value="Activity">社区活动</option>
                </select>
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">二级分类</label>
            <div class="layui-input-inline">
                <select id="secondCategorySelect" name="modules" lay-verify="required" lay-search="">
                    <option value="">直接选择或搜索选择</option>
                </select>
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">资源语言</label>
            <div class="layui-input-inline">
                <input type="text" id="language" name="language" lay-verify="required" placeholder="请输入语言"
                       autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">资源时间</label>
            <div class="layui-input-inline">
                <input id="resourceDate" type="resourceDate" class="layui-input" id="date1" placeholder="yyyy-MM-dd">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">分享方式</label>
            <div class="layui-input-inline">
                <input id="shareWay" type="text" name="number" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">资源类型</label>
            <div class="layui-input-inline">
                <input id="type" type="text" name="type" lay-verify="required" placeholder="资源类型" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">星级评分</label>
            <div class="layui-input-inline">
                <select id="star" lay-filter="star" name="modules" lay-verify="required" lay-search="">
                    <option value="">请选择星级评分</option>
                    <option value="5">★★★★★</option>
                    <option value="4">★★★★</option>
                    <option value="3">★★★</option>
                    <option value="2">★★</option>
                    <option value="1">★</option>
                </select>
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">适用环境</label>
            <div class="layui-input-inline">
                <input id="environment" type="text" name="environment" lay-verify="required" placeholder="请输入环境" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">资源大小</label>
            <div class="layui-input-inline">
                <input id="size" type="text" name="username" lay-verify="required" placeholder="单位KB,MB,GB,如:68KB"
                       autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">资源标签</label>
            <div class="layui-input-inline">
                <input id="marks" type="text" name="username" lay-verify="required" placeholder='标签用逗号","隔开'
                       autocomplete="off"
                       class="layui-input">
            </div>
        </div>
    </div>

    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">资源描述</label>
        <div class="layui-input-block">
            <textarea id="note" placeholder="可以在这里对资源进行一个简短的描述哦！" class="layui-textarea"></textarea>
        </div>
    </div>

    <div id="divTextEditor_toolbar" class="toolbar">
    </div>
    <div id="divTextEditor_text" class="text" style="min-height:600px;">
    </div>
    <script type="text/javascript" src="${ctxPath}/plugins/editor/wangEditor.min.js"></script>

</form>

<div class="layui-form-item">
    <button id="saveEdit" class="layui-btn" lay-submit="" lay-filter="demo2-">保 存 草 稿</button>
    <button id="submitEdit" class="layui-btn" lay-submit="" lay-filter="demo2-">提 交 编 辑</button>
</div>

<script type="text/javascript">

    layui.use('form', function () {
        var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
        form.render();
        form.on('select(firstCategory)', function (data) {
            changeSecondCategory(data.value);
        });
    });

    function changeSecondCategory(firstValue) {
        if (firstValue == "Softwares") {
            $('#secondCategorySelect').empty();
            $("#secondCategorySelect").append("<option value='Softwares_Security'>安全杀毒</option>");
            $("#secondCategorySelect").append("<option value='Softwares_StudyOffice'>学习办公</option>");
            $("#secondCategorySelect").append("<option value='Softwares_Tools'>实用工具</option>");
            $("#secondCategorySelect").append("<option value='Softwares_System'>系统软件</option>");
        }
        if (firstValue == "Course") {
            $('#secondCategorySelect').empty();
            $("#secondCategorySelect").append("<option value='Course_ProgramLanguage'>编程语言</option>");
            $("#secondCategorySelect").append("<option value='Course_FrontDesign'>前端设计</option>");
            $("#secondCategorySelect").append("<option value='Course_SysOperation'>系统运维</option>");
            $("#secondCategorySelect").append("<option value='Course_Security'>安全攻防</option>");
            $("#secondCategorySelect").append("<option value='Course_Architecture'>架构设计</option>");
        }
        if (firstValue == "SourceCode") {
            $('#secondCategorySelect').empty();
            $("#secondCategorySelect").append("<option value='SourceCode_Front'>前端源码</option>");
            $("#secondCategorySelect").append("<option value='SourceCode_PageFunction'>网页特效</option>");
            $("#secondCategorySelect").append("<option value='SourceCode_DevelopDemo'>开发实例</option>");
            $("#secondCategorySelect").append("<option value='SourceCode_SystemCode'>系统源码</option>");
        }
        if (firstValue == "News") {
            $('#secondCategorySelect').empty();
            $("#secondCategorySelect").append("<option value='News_Life'>生活资讯</option>");
            $("#secondCategorySelect").append("<option value='News_Culturl'>文化娱乐</option>");
            $("#secondCategorySelect").append("<option value='News_Finance'>金融动态</option>");
            $("#secondCategorySelect").append("<option value='News_SportsEconomic'>体育财经</option>");
            $("#secondCategorySelect").append("<option value='News_HotNews'>时事热点</option>");
        }
        if (firstValue == "Entertainment") {
            $('#secondCategorySelect').empty();
            $("#secondCategorySelect").append("<option value='Entertainment_Movies'>电影资讯</option>");
            $("#secondCategorySelect").append("<option value='Entertainment_Pictures'>福利美图</option>");
        }
        if (firstValue == "Activity") {
            $('#secondCategorySelect').empty();
            $("#secondCategorySelect").append("<option value='Activity_OnLine'>线上互动</option>");
            $("#secondCategorySelect").append("<option value='Activity_OffLine'>线下分享</option>");
            $("#secondCategorySelect").append("<option value='Activity_Party'>交友聚会</option>");
        }
        layui.use('form', function () {
            var form = layui.form; //重新渲染表单，否则显示不出来
            form.render();
            form.on('select(firstCategory)', function (data) {
                changeSecondCategory(data.value);
            });
        });
    }
</script>

<script>
    //创建富文本编辑器 http://www.wangeditor.com/index.html
    var E = window.wangEditor;
    var editor = new E('#divTextEditor_toolbar', '#divTextEditor_text');
    // 自定义菜单配置
    editor.customConfig.menus = [
        'head',  // 标题
        'bold',  // 粗体
        'fontSize',  // 字号
        'fontName',  // 字体
        'italic',  // 斜体
        'underline',  // 下划线
        'strikeThrough',  // 删除线
        'foreColor',  // 文字颜色
        'backColor',  // 背景颜色
        'link',  // 插入链接
        'list',  // 列表
        'justify',  // 对齐方式
        'quote',  // 引用
        'emoticon',  // 表情
        'image',  // 插入图片
        'table',  // 表格
        'video',  // 插入视频
        'code',  // 插入代码
        'undo',  // 撤销
        'redo'  // 重复
    ];
    // 下面两个配置，使用其中一个即可显示“上传图片”的tab。但是两者不要同时使用！！！
    //editor.customConfig.uploadImgShowBase64 = true;   // 使用 base64 保存图片，简单方便，但可能对显示性能有影响
    editor.customConfig.uploadImgServer = '/gateway/fileupload/image';  // 上传图片到服务器

    editor.customConfig.uploadFileName = 'uploadPic';
    editor.customConfig.uploadImgMaxSize = 3 * 1024 * 1024; // 图片大小限制为 3M
    editor.customConfig.uploadImgMaxLength = 5; //限制一次最多上传 5 张图片
    editor.customConfig.uploadImgTimeout = 100000;//timeout时间改为10s

    editor.customConfig.pasteFilterStyle = false;//关闭粘贴样式的过滤，保留粘贴内容格式，默认不保留原格式
    //editor.customConfig.pasteIgnoreImg = true;//忽略掉粘贴内容中的图片，默认可粘贴

    editor.customConfig.onblur = function (html) {//失去焦点的动作
        // html 即编辑器中的内容
        console.log('onblur', html)
    };

    editor.customConfig.customAlert = function (info) {//上传图片的错误提示默认使用alert弹出，你也可以自定义用户体验更好的提示方式
        // info 是需要提示的内容
        alert('自定义提示：' + info)
    }

    // 自定义配置颜色（字体颜色、背景色）
    editor.customConfig.colors = [
        '#000000',
        '#eeece0',
        '#1c487f',
        '#4d80bf',
        '#c24f4a',
        '#8baa4a',
        '#7b5ba1',
        '#46acc8',
        '#f9963b',
        '#ffffff'
    ];

    editor.create();

    //editor.txt.html('<p>用 JS 设置的内容</p>');//初始化editor内容
    //editor.txt.append('<p>追加的内容</p>');//向editor追加内容
    //editor.txt.clear();//清空编辑器内容

    // 插入网络图片，url即插入图片的地址
    /*editor.customConfig.linkImgCallback = function (url) {
     console.log(url)
     }*/

    //上传到服务器
    editor.customConfig.uploadImgHooks = {
        before: function (xhr, editor, files) {
            // 图片上传之前触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，files 是选择的图片文件

            // 如果返回的结果是 {prevent: true, msg: 'xxxx'} 则表示用户放弃上传
            // return {
            //     prevent: true,
            //     msg: '放弃上传'
            // }
        },
        success: function (xhr, editor, result) {
            // 图片上传并返回结果，图片插入成功之后触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，result 是服务器端返回的结果
            alert("success:" + result);
        },
        fail: function (xhr, editor, result) {
            // 图片上传并返回结果，但图片插入错误时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，result 是服务器端返回的结果
            alert("fail:" + result);
        },
        error: function (xhr, editor) {
            // 图片上传出错时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象
            alert("error");
        },
        timeout: function (xhr, editor) {
            // 图片上传超时时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象
            alert("timeout");
        },

        // 如果服务器端返回的不是 {errno:0, data: [...]} 这种格式，可使用该配置
        // （但是，服务器端返回的必须是一个 JSON 格式字符串！！！否则会报错）
        customInsert: function (insertImg, result, editor) {
            // 图片上传并返回结果，自定义插入图片的事件（而不是编辑器自动插入图片！！！）
            // insertImg 是插入图片的函数，editor 是编辑器对象，result 是服务器端返回的结果

            // 举例：假如上传图片成功后，服务器端返回的是 {url:'....'} 这种格式，即可这样插入图片：
            var url = result.url
            insertImg(url)

            // result 必须是一个 JSON 格式字符串！！！否则报错
            alert("customInsert");
        }
    }

    //提交编辑
    document.getElementById('submitEdit').addEventListener('click', function () {
        var title = $("#title").val();
        var note = $("#note").val();
        var secondCategorySelect = $("#secondCategorySelect").val();
        var language = $("#language").val();
        var resourceDate = $("#resourceDate").val();
        var shareWay = $("#shareWay").val();
        var type = $("#type").val();
        var star = $("#star").val();
        var environment = $("#environment").val();
        var marks = $("#marks").val();
        var size = $("#size").val();
        var pageTemplate = $("#pageTemplate").val();
        var content = editor.txt.html();
        console.log("title="+title);
        console.log("note="+note);
        console.log("secondCategorySelect="+secondCategorySelect);
        console.log("language="+language);
        console.log("resourceDate="+resourceDate);
        console.log("shareWay="+shareWay);
        console.log("type="+type);
        console.log("star="+star);
        console.log("environment="+environment);
        console.log("marks="+marks);
        console.log("size="+size);
        console.log("pageTemplate="+pageTemplate);
        console.log("content="+content);
        $.ajax({
            async: false,
            data: {
                "title": title,
                "note": note,
                "secondCategorySelect": secondCategorySelect,
                "language": language,
                "resourceDate": resourceDate,
                "shareWay": shareWay,
                "type": type,
                "star": star,
                "environment": environment,
                "marks": marks,
                "size": size,
                "pageTemplate": pageTemplate,
                "content": content
            },
            type: "post",
            url: "/front/resource/doSave/new.action",
            datatype: 'json',
            success: function (data) {
                temp = data;
                if (temp == "true") {
                    layer.msg('成功~');
                } else {
                    layer.msg(data);
                }
            }
        });
    }, false)

    // 封装 console.log 函数
    function printLog(title, info) {
        window.console && console.log(title, info);
    }

</script>



